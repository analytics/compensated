<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Numeric.Compensated</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Numeric-Compensated.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Numeric-Compensated.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">compensated-0.3: Compensated floating-point arithmetic</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Portability</th><td>non-portable</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Maintainer</th><td>Edward Kmett &lt;ekmett@gmail.com&gt;</td></tr><tr><th>Safe Haskell</th><td>Safe-Infered</td></tr></table><p class="caption">Numeric.Compensated</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">lifting scalars
</a></li><li><a href="#g:2">compensated operators
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides a fairly extensive API for compensated
 floating point arithmetic based on Knuth's error free
 transformation, various algorithms by Ogita, Rump and Oishi,
 Hida, Li and Bailey, Kahan summation, etc. with custom compensated
 arithmetic circuits to do multiplication, division, etc. of compensated
 numbers.
</p><p>In general if <code>a</code> has x bits of significand, <code>Compensated a</code> gives
 you twice that. You can iterate this construction for arbitrary
 precision.
</p><p>References:
</p><ul><li> <a href="http://web.mit.edu/tabbott/Public/quaddouble-debian/qd-2.3.4-old/docs/qd.pdf">http://web.mit.edu/tabbott/Public/quaddouble-debian/qd-2.3.4-old/docs/qd.pdf</a>
</li><li> <a href="http://www.ti3.tuhh.de/paper/rump/OgRuOi05.pdf">http://www.ti3.tuhh.de/paper/rump/OgRuOi05.pdf</a>
</li><li> Donald Knuth's &quot;The Art of Computer Programming, Volume 2: Seminumerical Algorithms&quot;
</li><li> <a href="http://en.wikipedia.org/wiki/Kahan_summation_algorithm">http://en.wikipedia.org/wiki/Kahan_summation_algorithm</a>
</li></ul></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">class</span> (<a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:RealFrac">RealFrac</a> a, Precise a, <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Floating">Floating</a> a) =&gt; <a href="#t:Compensable">Compensable</a> a  <span class="keyword">where</span><ul class="subs"><li><span class="keyword">data</span> <a href="#t:Compensated">Compensated</a> a </li><li><a href="#v:with">with</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; (a -&gt; a -&gt; r) -&gt; r</li><li><a href="#v:compensated">compensated</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a</li><li><a href="#v:magic">magic</a> :: a</li></ul></li><li class="src short"><a href="#v:_Compensated">_Compensated</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Iso-39-">Iso'</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a) (a, a)</li><li class="src short"><span class="keyword">type</span> <a href="#t:Overcompensated">Overcompensated</a> a = <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a)</li><li class="src short"><a href="#v:primal">primal</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Lens-39-">Lens'</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a) a</li><li class="src short"><a href="#v:residual">residual</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Lens-39-">Lens'</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a) a</li><li class="src short"><a href="#v:uncompensated">uncompensated</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; a</li><li class="src short"><a href="#v:fadd">fadd</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Num">Num</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r</li><li class="src short"><a href="#v:add">add</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Num">Num</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r</li><li class="src short"><a href="#v:times">times</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r</li><li class="src short"><a href="#v:squared">squared</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r</li><li class="src short"><a href="#v:divide">divide</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r</li><li class="src short"><a href="#v:split">split</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r</li><li class="src short"><a href="#v:kahan">kahan</a> :: (<a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Data-Foldable.html#t:Foldable">Foldable</a> f, <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a) =&gt; f a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a</li><li class="src short"><a href="#v:-43--94-">(+^)</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a</li><li class="src short"><a href="#v:-42--94-">(*^)</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a</li><li class="src short"><a href="#v:square">square</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">class</span> (<a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:RealFrac">RealFrac</a> a, Precise a, <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Floating">Floating</a> a) =&gt; <a name="t:Compensable" class="def">Compensable</a> a  <span class="keyword">where</span><a href="src/Numeric-Compensated.html#Compensable" class="link">Source</a></p><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">data</span> <a name="t:Compensated" class="def">Compensated</a> a <a href="src/Numeric-Compensated.html#Compensated" class="link">Source</a></p><div class="doc"><p>This provides a numeric data type with effectively doubled precision by
 using Knuth's error free transform and a number of custom compensated
 arithmetic circuits.
</p><p>This construction can be iterated, doubling precision each time.
</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>round (Prelude.product [2..100] :: Compensated (Compensated (Compensated Double)))
</code></strong>93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>Prelude.product [2..100]
</code></strong>93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000
</pre></div></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:with" class="def">with</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; (a -&gt; a -&gt; r) -&gt; r<a href="src/Numeric-Compensated.html#with" class="link">Source</a></p><div class="doc"><p>This extracts both the <code><a href="Numeric-Compensated.html#v:primal">primal</a></code> and <code><a href="Numeric-Compensated.html#v:residual">residual</a></code> components of a <code><a href="Numeric-Compensated.html#t:Compensated">Compensated</a></code>
 number.
</p></div><p class="src"><a name="v:compensated" class="def">compensated</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a<a href="src/Numeric-Compensated.html#compensated" class="link">Source</a></p><div class="doc"><p>Used internally to construct <code><a href="Numeric-Compensated.html#v:compensated">compensated</a></code> values that satisfy our residual contract.
</p><p>When in doubt, use <code><code><a href="Numeric-Compensated.html#v:add">add</a></code> a b <code><a href="Numeric-Compensated.html#v:compensated">compensated</a></code></code> instead of <code><code><a href="Numeric-Compensated.html#v:compensated">compensated</a></code> a b</code>
</p></div><p class="src"><a name="v:magic" class="def">magic</a> :: a<a href="src/Numeric-Compensated.html#magic" class="link">Source</a></p><div class="doc"><p>This <code><a href="Numeric-Compensated.html#v:magic">magic</a></code> number is used to <code><a href="Numeric-Compensated.html#v:split">split</a></code> the significand in half, so we can multiply
 them separately without losing precision in <code><a href="Numeric-Compensated.html#v:times">times</a></code>.
</p></div></div><div class="subs instances"><p id="control.i:Compensable" class="caption collapser" onclick="toggleSection('i:Compensable')">Instances</p><div id="section.i:Compensable" class="show"><table><tr><td class="src"><a href="Numeric-Compensated.html#t:Compensable">Compensable</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Double">Double</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Numeric-Compensated.html#t:Compensable">Compensable</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Float">Float</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:_Compensated" class="def">_Compensated</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Iso-39-">Iso'</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a) (a, a)<a href="src/Numeric-Compensated.html#_Compensated" class="link">Source</a></p><div class="doc"><p>This provides the isomorphism between the compact representation we store these in internally
 and the naive pair of the <code><a href="Numeric-Compensated.html#v:primal">primal</a></code> and <code><a href="Numeric-Compensated.html#v:residual">residual</a></code> components.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Overcompensated" class="def">Overcompensated</a> a = <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a)<a href="src/Numeric-Compensated.html#Overcompensated" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:primal" class="def">primal</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Lens-39-">Lens'</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a) a<a href="src/Numeric-Compensated.html#primal" class="link">Source</a></p><div class="doc"><p>This <code><a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Lens">Lens</a></code> lets us edit the <code><a href="Numeric-Compensated.html#v:primal">primal</a></code> directly, leaving the <code><a href="Numeric-Compensated.html#v:residual">residual</a></code> untouched.
</p></div></div><div class="top"><p class="src"><a name="v:residual" class="def">residual</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Lens-39-">Lens'</a> (<a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a) a<a href="src/Numeric-Compensated.html#residual" class="link">Source</a></p><div class="doc"><p>This <code><a href="/Users/ekmett/.cabal/share/doc/lens-3.10/html/Control-Lens-Type.html#t:Lens">Lens</a></code> lets us edit the <code><a href="Numeric-Compensated.html#v:residual">residual</a></code> directly, leaving the <code><a href="Numeric-Compensated.html#v:primal">primal</a></code> untouched.
</p></div></div><div class="top"><p class="src"><a name="v:uncompensated" class="def">uncompensated</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; a<a href="src/Numeric-Compensated.html#uncompensated" class="link">Source</a></p><div class="doc"><p>Extract the <code><a href="Numeric-Compensated.html#v:primal">primal</a></code> component of a <code><a href="Numeric-Compensated.html#v:compensated">compensated</a></code> value, when and if compensation
 is no longer required.
</p></div></div><div class="top"><p class="src"><a name="v:fadd" class="def">fadd</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Num">Num</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r<a href="src/Numeric-Compensated.html#fadd" class="link">Source</a></p><div class="doc"><p><code><code><a href="Numeric-Compensated.html#v:fadd">fadd</a></code> a b k</code> computes <code>k x y</code> such that
</p><pre> x + y = a + b
 x = fl(a + b)
</pre><p>but only under the assumption that <code><code><a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#v:abs">abs</a></code> a <code><a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Data-Ord.html#v:-62--61-">&gt;=</a></code> <code><a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#v:abs">abs</a></code> b</code>. If you
 aren't sure, use <code><a href="Numeric-Compensated.html#v:add">add</a></code>.
</p><p>Which is to say that <code>x</code> is the floating point image of <code>(a + b)</code> and
 <code>y</code> stores the residual error term.
</p></div></div><h1 id="g:1">lifting scalars
</h1><div class="top"><p class="src"><a name="v:add" class="def">add</a> :: <a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Prelude.html#t:Num">Num</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r<a href="src/Numeric-Compensated.html#add" class="link">Source</a></p><div class="doc"><p><code><code><a href="Numeric-Compensated.html#v:add">add</a></code> a b k</code> computes <code>k x y</code> such that
</p><pre> x + y = a + b
 x = fl(a + b)
</pre><p>Which is to say that <code>x</code> is the floating point image of <code>(a + b)</code> and
 <code>y</code> stores the residual error term.
</p></div></div><div class="top"><p class="src"><a name="v:times" class="def">times</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r<a href="src/Numeric-Compensated.html#times" class="link">Source</a></p><div class="doc"><p><code><code><a href="Numeric-Compensated.html#v:times">times</a></code> a b k</code> computes <code>k x y</code> such that
</p><pre> x + y = a * b
 x = fl(a * b)
</pre><p>Which is to say that <code>x</code> is the floating point image of <code>(a * b)</code> and
 <code>y</code> stores the residual error term.
</p><p>This could be nicer if we had access to a hardware fused multiply-add.
</p></div></div><div class="top"><p class="src"><a name="v:squared" class="def">squared</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r<a href="src/Numeric-Compensated.html#squared" class="link">Source</a></p><div class="doc"><p><code><code><a href="Numeric-Compensated.html#v:squared">squared</a></code> a k</code> computes <code>k x y</code> such that
</p><pre> x + y = a * a
 x = fl(a * a)
</pre><p>Which is to say that <code>x</code> is the floating point image of <code>(a * a)</code> and
 <code>y</code> stores the residual error term.
</p></div></div><div class="top"><p class="src"><a name="v:divide" class="def">divide</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r<a href="src/Numeric-Compensated.html#divide" class="link">Source</a></p></div><div class="top"><p class="src"><a name="v:split" class="def">split</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; (a -&gt; a -&gt; r) -&gt; r<a href="src/Numeric-Compensated.html#split" class="link">Source</a></p><div class="doc"><p>error-free split of a floating point number into two parts.
</p><p>Note: these parts do not satisfy the <code><a href="Numeric-Compensated.html#v:compensated">compensated</a></code> contract
</p></div></div><div class="top"><p class="src"><a name="v:kahan" class="def">kahan</a> :: (<a href="/Library/Frameworks/GHC.framework/Versions/7.4.1-x86_64/usr/share/doc/ghc/html/libraries/base-4.5.0.0/Data-Foldable.html#t:Foldable">Foldable</a> f, <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a) =&gt; f a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a<a href="src/Numeric-Compensated.html#kahan" class="link">Source</a></p><div class="doc"><p>Perform Kahan summation over a list.
</p></div></div><div class="top"><p class="src"><a name="v:-43--94-" class="def">(+^)</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a<a href="src/Numeric-Compensated.html#%2B%5E" class="link">Source</a></p><div class="doc"><p>Calculate a scalar + compensated sum with Kahan summation.
</p></div></div><div class="top"><p class="src"><a name="v:-42--94-" class="def">(*^)</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a<a href="src/Numeric-Compensated.html#%2A%5E" class="link">Source</a></p><div class="doc"><p>Compute <code>a * <code><a href="Numeric-Compensated.html#t:Compensated">Compensated</a></code> a</code>
</p></div></div><h1 id="g:2">compensated operators
</h1><div class="top"><p class="src"><a name="v:square" class="def">square</a> :: <a href="Numeric-Compensated.html#t:Compensable">Compensable</a> a =&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a -&gt; <a href="Numeric-Compensated.html#t:Compensated">Compensated</a> a<a href="src/Numeric-Compensated.html#square" class="link">Source</a></p><div class="doc"><p>Calculate a fast square of a compensated number.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>